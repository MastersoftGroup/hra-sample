"use strict";angular.module("hraAutocomplete",[]).directive("hraAutocomplete",["$http","$parse",function(t,e){function a(t,e,a){t.encodedAuth=btoa(e.hraLogin),t.baseUrl=e.hraUrl||"https://hosted.mastersoftgroup.com",a.jsonp(t.baseUrl+"/harmony/rest/au/generateID?callback=JSON_CALLBACK&Authorization=Basic+"+t.encodedAuth).then(function(e){(e.data.status="SUCCESS")?t.transactionId=e.data.payload:t.transactionId=""})}return{restrict:"AE",replace:!0,template:'<input type="text" />',require:"ngModel",controller:["$scope","$attrs","$http",function(t,e,n){a(t,e,n)}],compile:function(a,n){var r=e(n.ngModel);return function(e,a,n,o){var l=[],u=n.hraDelay||500,c=n.hraMinLength||3,s=n.hraSot||"AUPAF",i="au";"NZPAF"==s&&(i="nz"),a.autocomplete({minLength:c,delay:u,source:function(a,n){var r=e.baseUrl+"/harmony/rest/"+i+"/address?callback=JSON_CALLBACK&fullAddress="+a.term+"&Authorization=Basic+"+e.encodedAuth+"&sourceOfTruth="+s+"&transactionID="+e.transactionId;t.jsonp(r).success(function(t){return"SUCCESS"==t.status&&(l=$.map(t.payload,function(t){return{label:t.fullAddress}})),n(l)})},select:function(t,e){t.preventDefault(),$(this).val(e.item.label)},change:function(t,n){for(var o=a.val(),u=null,c=0;c<l.length;c++)if(l[c].label===o){u=l[c].label;break}u||e.$apply(function(t){r.assign(t,null)})}})}}}}]);
